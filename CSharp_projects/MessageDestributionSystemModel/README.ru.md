Этот README доступен на другом языке:
[en version](README.md)

[Вернуться к списку проектов](../README.ru.md)

# Система рассылки сообщений

## Цель
Отработать структурные паттерны, применить принципы **ООП**, **SOLID** и **GRASP**, а также навыки мокирования в автоматических тестах.  
Реализовать модель доставки сообщений по различным типам адресатов и покрыть поведение функциональными автотестами.

---

## Краткое описание
Модель описывает поток сообщений внутри корпоративной системы: сообщения имеют заголовок, тело и уровень важности; топики группируют адресатов и пересылают им сообщения.  
Адресаты могут быть разными: пользователь, внешние мессенджеры, физические дисплеи или группы адресатов. Поддерживаются фильтрация по важности и логирование доставки. Статус прочтения хранится только у пользователя.

---

## Основные компоненты
- **Message** — заголовок, тело, уровень важности.  
- **Topic** — имя и список адресатов; отправляет сообщение каждому адресату с учётом их фильтров/логирования.  
- **Recipient (адресат)** — интерфейс приёма сообщения; реализаций несколько:
  - **UserRecipient** — доставка сообщения пользователю; хранит сообщения с статусом (непрочитано/прочитано); можно отметить прочитанным (только если было не прочитано).  
  - **MessengerRecipient** — отправляет текст через внешнюю систему (для тестов — вывод в консоль / мок).  
  - **DisplayRecipient** — выводит текст на устройство с цветом; держит только одно сообщение (очистка перед записью).  
  - **GroupRecipient** — содержит набор адресатов и пересылает сообщение каждому из них.  
- **DisplayDriver** — абстракция для дисплея: очистка, установка цвета, вывод текста.
- **Filter** — задаёт критерии по уровню важности; применяется у адресата для отсева нежелательных сообщений.  
- **Logger** — при включённом логировании адресата записывает событие получения сообщения.
- **Repository / Registry** (при необходимости) — хранение конфигураций топиков/адресатов в памяти.

---

## Используемые паттерны и подходы
- **Adapter / Facade** — обёртки над внешними мессенджерами и драйверами дисплеев.  
- **Composite** — GroupRecipient для композиции адресатов.  
- **Decorator** — динамическое добавление фильтра и/или логирования к адресатам (или альтернативно Chain of Responsibility для фильтрации).  
- **Repository (In-Memory)** — хранение топиков и адресатов.  
- **Dependency Injection** — для подстановки драйверов/логгеров в тестах.  
- **Mocking** — моки используются в тестах для проверки фильтрации, логирования и интеграции с внешними точками.

---

## Тестовые сценарии

| № | Тестовый случай | Ожидаемый результат |
|---|------------------|----------------------|
| 1 | При получении сообщения пользователем | Сообщение сохраняется со статусом `не прочитано` |
| 2 | Отметить `не прочитано` → `прочитано` | Статус меняется на `прочитано` |
| 3 | Отметить уже `прочитанное` как прочитанное | Ошибка: операция недопустима |
| 4 | Фильтр важности у адресата (мок) — сообщение ниже порога | Сообщение не доставлено адресату |
| 5 | Логгирование у адресата (мок) — при получении сообщения | Генерируется запись лога |
| 6 | Отправка в Messenger (мок) | Вызван ожидаемый метод/вывод мессенджера |
| 7 | Два адресата-пользователя + фильтр у одного | При отправке сообщения ниже порога: пользователь без фильтра получает сообщение один раз; фильтруемый — не получает |

---

## Технологии
- **C# (.NET 8)**
- **NUnit / xUnit** — автотесты  
- **Moq / аналог** — мокирование зависимостей  
- Паттерны: **Composite**, **Adapter/Facade**, **Decorator**, **Repository**

---
## Результат
Готовая объектная модель маршрутизации сообщений с разнообразными типами адресатов, поддержкой фильтрации и логирования, адаптацией внешних точек и покрытием функциональных сценариев автотестами.
